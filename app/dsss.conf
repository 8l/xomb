name = xomb

CC = x86_64-pc-elf-gcc
CFLAGS = -nostdlib -nodefaultlibs -g -DUSE_ASSERT -mcmodel=kernel

[*]
buildflags=-dc=ldc-xomb

[testapp.d]

buildflags=-dc=ldc-xomb -I..

# compile runtime

prebuild= \
\
\echo ;\
echo "Building Application Runtime (mindrt)" ;\
mkdir -p dsss_imports;\
mkdir -p dsss_objs;\
mkdir -p dsss_objs/G;\
mkdir -p dsss_objs/O;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/object.d -ofdsss_objs/G/runtime.object.o; \
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/invariant.d -ofdsss_objs/G/runtime.invariant.o; \
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/dstubs.d -ofdsss_objs/G/runtime.dstubs.o; \
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/util.d -ofdsss_objs/G/runtime.util.o; \
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/util.d -ofdsss_objs/G/runtime.util.o; \
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/stdarg.d -ofdsss_objs/G/runtime.std.stdarg.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/moduleinit.d -ofdsss_objs/G/runtime.std.moduleinit.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/intrinsic.d -ofdsss_objs/G/runtime.std.intrinsic.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/moduleinit.d -ofdsss_objs/G/runtime.std.moduleinit.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_AC.d -ofdsss_objs/G/runtime.std.typeinfo.ti_AC.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Acdouble.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Acdouble.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Acfloat.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Acfloat.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Ag.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Ag.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Aint.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Aint.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Along.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Along.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Areal.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Areal.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_Ashort.d -ofdsss_objs/G/runtime.std.typeinfo.ti_Ashort.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_C.d -ofdsss_objs/G/runtime.std.typeinfo.ti_C.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_byte.d -ofdsss_objs/G/runtime.std.typeinfo.ti_byte.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_cdouble.d -ofdsss_objs/G/runtime.std.typeinfo.ti_cdouble.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_cfloat.d -ofdsss_objs/G/runtime.std.typeinfo.ti_cfloat.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_char.d -ofdsss_objs/G/runtime.std.typeinfo.ti_char.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_creal.d -ofdsss_objs/G/runtime.std.typeinfo.ti_creal.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_dchar.d -ofdsss_objs/G/runtime.std.typeinfo.ti_dchar.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_delegate.d -ofdsss_objs/G/runtime.std.typeinfo.ti_delegate.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_double.d -ofdsss_objs/G/runtime.std.typeinfo.ti_double.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_float.d -ofdsss_objs/G/runtime.std.typeinfo.ti_float.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_idouble.d -ofdsss_objs/G/runtime.std.typeinfo.ti_idouble.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_ifloat.d -ofdsss_objs/G/runtime.std.typeinfo.ti_ifloat.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_int.d -ofdsss_objs/G/runtime.std.typeinfo.ti_int.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_ireal.d -ofdsss_objs/G/runtime.std.typeinfo.ti_ireal.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_long.d -ofdsss_objs/G/runtime.std.typeinfo.ti_long.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_ptr.d -ofdsss_objs/G/runtime.std.typeinfo.ti_ptr.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_real.d -ofdsss_objs/G/runtime.std.typeinfo.ti_real.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_short.d -ofdsss_objs/G/runtime.std.typeinfo.ti_short.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_ubyte.d -ofdsss_objs/G/runtime.std.typeinfo.ti_ubyte.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_uint.d -ofdsss_objs/G/runtime.std.typeinfo.ti_uint.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_ulong.d -ofdsss_objs/G/runtime.std.typeinfo.ti_ulong.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_ushort.d -ofdsss_objs/G/runtime.std.typeinfo.ti_ushort.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_void.d -ofdsss_objs/G/runtime.std.typeinfo.ti_void.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/typeinfo/ti_wchar.d -ofdsss_objs/G/runtime.std.typeinfo.ti_wchar.o;\
ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/entry.d -ofdsss_objs/G/runtime.entry.o;\
#ldc -nodefaultlib -I../runtimes/mindrt/. -c ../runtimes/mindrt/std/c/stdarg.d -ofdsss_objs/G/runtime.std.c.stdarg.o;\
#yasm -o dsss_objs/O/runtime.entry.o ../runtimes/mindrt/entry.s -felf64;\

target = testapp

# we will need some post build foo to link to the runtime

postbuild = \
\
echo ; \
echo Creating Application Executable; \
echo '--> testapp';\
ld -nostdlib -nodefaultlibs -b elf64-x86-64 -Ttext 0x100000 -o testapp `ls dsss_objs/G/*.o` `ls dsss_objs/O/*.o`;\
\
echo ;\
echo Creating App Dump; \
echo '--> testapp.dump';\
rm -f testapp.dump && objdump -d -S -r testapp > testapp.dump;
